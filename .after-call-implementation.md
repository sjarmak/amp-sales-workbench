# After Call Tab Implementation Summary

## Files Created/Modified

### Created Files:
1. **web/components/AfterCallTab.tsx** - Main After Call tab component
2. **web/components/ui/textarea.tsx** - Textarea UI component (shadcn/ui)
3. **web/components/ui/separator.tsx** - Separator UI component (shadcn/ui)

### Modified Files:
1. **api-server.ts** - Added API endpoint `GET /api/accounts/:slug/postcall/:timestamp`
2. **web/app/page.tsx** - Integrated AfterCallTab component into main page

### Dependencies Added:
- `@radix-ui/react-separator` (npm package)

## Features Implemented

### 1. Call Metadata Display
- Call title, date, duration, and participants
- Recording link (external)
- Visual icons (Calendar, Clock, Users, ExternalLink from lucide-react)

### 2. Post-Call Summary (Tabbed Interface)
Three tabs: Analysis, Actions, Insights

**Analysis Tab:**
- Customer sentiment with colored badges (positive/neutral/negative)
- Per-stakeholder sentiment breakdown
- Next steps list
- Blockers with red highlight

**Actions Tab:**
- Task cards with priority badges (high/medium/low)
- Due dates and task owners
- Task type badges (follow-up/internal/customer-action)

**Insights Tab:**
- Success criteria mentioned
- Feature requests
- Stage progression signals (current â†’ suggested)
- Suggested close date with confidence level

### 3. Follow-up Email Draft
- Preview/Edit toggle
- Editable fields: To, Subject, Body
- Copy to clipboard functionality
- Send button (placeholder for future)

### 4. Coaching Feedback
- What went well (green highlight)
- Areas for improvement (orange highlight)
- Suggested next steps

### 5. CRM Updates Preview
- YAML patch display
- Copy button for easy sharing

## API Integration

### New Endpoint:
```
GET /api/accounts/:slug/postcall/:timestamp
```

Returns post-call JSON data from `data/accounts/<slug>/postcall/postcall-<timestamp>.json`

### Data Flow:
1. Component loads latest post-call data via `GET /api/accounts/:slug/postcall`
2. Displays all sections with proper formatting and badges
3. Email draft is editable in-component
4. All data matches PostCallUpdate interface from src/agents/postCallUpdate.ts

## UI/UX Features

- Loading states for async data fetching
- Empty state when no post-call data exists
- Responsive card layout
- Color-coded badges for sentiment, priority, confidence
- Collapsible/expandable sections via tabs
- Copy-to-clipboard functionality
- Icons from lucide-react throughout

## Design Patterns Followed

- Follows PreCallPrepTab.tsx structure and conventions
- Uses shadcn/ui components consistently
- Implements API_URL constant for backend communication
- TypeScript interfaces match backend types
- Error handling with try/catch and fallbacks

## Integration Points

The After Call tab integrates with:
- Post-call agent (`src/agents/postCallUpdate.ts`)
- Gong MCP for call transcripts
- Salesforce MCP for CRM updates
- Coaching agent (hardcoded placeholder data currently)

## Next Steps (Future Enhancements)

1. Add actual coaching agent integration (currently uses placeholder data)
2. Implement "Send Email" functionality
3. Add call selector to view historical post-call summaries
4. Add Apply CRM Updates button to push changes to Salesforce
5. Add export to Notion functionality
6. Add filtering/sorting for tasks by priority or type
